{% extends "base.html" %}

{% block title %} 
    Ship Areas & Details 
{% endblock %}

{% csrf_token %}

{% load custom_filters %}

{% block content %}
    <!-- Summaries -->
    <div class="headlines">
        <div class="summary-boxes">
            <h4 class="summary-title">Time Remaining:</h4>
            <h2 class="summary-content">{{ statistics.total_time }} Days</h2>
        </div>

        <div class="summary-boxes">
            <h4 class="summary-title">Completion Date:</h4>
            <h2 class="summary-content">{{ today }}</h2>
        </div>
        
        <div class="summary-boxes">
            <h4 class="summary-title">Ship and Areas</h4>
            <h2 class="summary-content">{{ num_ships }}, {{ num_areas }}</h2>
        </div>
        
        <div class="summary-boxes">
            <h4 class="summary-title">Processing Time / Ship:</h4>
            <h2 class="summary-content">TBE</h2>
        </div>
    </div>

    <!-- Ship and Area Details -->
    <div class="card-container">
        {% for ship in ships %}
            <div class="ship-card {% if ship.time_remaining == 0 %} ship-card-completed {% endif %}">
                 <div class="progress">
                    <div class="progress-bar" role="progressbar" style="width: {{ ship.completed_percentage }}%;" aria-valuenow="{{ ship.completed_percentage }}" aria-valuemin="0" aria-valuemax="100">{{ ship.completed_percentage }}%</div>
                </div>
                <h5 class="card-title">{{ ship.name }}</h5>
                <h5 class="card-secondary-title">Contract Number: {{ ship.contract_number }}</h5>
                {% if user.is_authenticated %}
                    <style>
                        .areas-and-scans {
                            margin-top: 8px;
                        }
                    </style>
                    {% if ship.time_remaining == 0 %}
                        <p class="card-text done">Completed</p>
                    {% else %}
                        <p class="card-text to-be-completed">Completion in {{ ship.time_remaining }} days</p>
                    {% endif %}
                {% endif %}
                {% if ship.image %}
                    <img src="{{ ship.image.url }}" class="ship-image" alt="...">
                {% endif %}
                <div class="areas-and-scans">
                    <div class="scans">
                        <p class="card-text">Scans</p>
                        <p class="card-feature-text">{{ ship.total_scans }}</p>
                    </div>
                    <div class="areas">
                        <p class="card-text">Areas</p>
                        <p class="card-feature-text">{{ ship.area_set.all.count }}</p>
                    </div>
                </div>
                <!-- <p class="card-text">Priority: {{ ship.priority }}</p> -->
                <button class="more-info">
                    <a href="{% url 'ship_detail' ship.id %}">More Info</a>
                </button>
            </div>
        {% endfor %}

        <!-- Add Ship -->
        {% if user.is_superuser %}
            <form class="area-form" method="post">
                {% csrf_token %}
                <div class="ship-card">
                    <div class="progress">
                        <div class="progress-bar" role="progressbar" style="width: {{ ship.completed_percentage }}%;" aria-valuenow="{{ ship.completed_percentage }}" aria-valuemin="0" aria-valuemax="100">{{ ship.completed_percentage }}%</div>
                    </div>
                    <h5 class="card-title">{{ ship_form.name}}</h5>
                    <h5 class="card-secondary-title">Contract Number: {{ ship_form.contract_number}}</h5>
                    {{ ship_form.image}}
                    {{ ship_form.company}}
                    {{ ship_form.priority}}
                    <div>
                        <button class="crud-button add" type="submit">Add Area</button>
                    </div>
                </div>
            </form>
        {% endif %}
    </div>
{% endblock %}
